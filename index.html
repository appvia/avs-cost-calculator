<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VMware to Azure VMware Solution Migration ROI Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 500;
        }
        .tab.active {
            background: white;
            color: #0078d4;
            border-bottom: 3px solid #0078d4;
        }
        .tab:hover {
            background: #e9ecef;
        }
        .tab-content {
            display: none;
            padding: 30px;
        }
        .tab-content.active {
            display: block;
        }
        .section {
            margin-bottom: 40px;
        }
        .section h2 {
            color: #0078d4;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .input-field {
            display: flex;
            flex-direction: column;
        }
        .input-field label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .input-field input, .input-field select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: #0078d4;
        }
        .calculate-btn {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 30px auto;
            min-width: 200px;
        }
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,120,212,0.3);
        }
        .results {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
        }
        .results h2 {
            color: #0078d4;
            margin-bottom: 20px;
            text-align: center;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #0078d4;
        }
        .metric-label {
            font-weight: 500;
            color: #333;
        }
        .metric-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #0078d4;
        }
        .positive {
            color: #28a745;
        }
        .funding {
            color: #17a2b8;
            font-weight: bold;
        }
        .negative {
            color: #dc3545;
        }
        .breakdown {
            margin-top: 30px;
        }
        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .breakdown-table th, .breakdown-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        .breakdown-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        .breakdown-table tr:hover {
            background: #f8f9fa;
        }
        .formula-box {
            background: #e3f2fd;
            border: 1px solid #0078d4;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        .formula-box h4 {
            margin-top: 0;
            color: #0078d4;
        }

        /* Tooltip styles */
        .info-icon {
            position: relative;
            display: inline-block;
            cursor: help;
            width: 16px;
            height: 16px;
            background: #0078d4;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 12px;
            line-height: 16px;
            font-weight: bold;
        }
        
        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .tooltip {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            font-weight: normal;
            line-height: 1.4;
        }
        
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .modernisation-summary {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .modernisation-summary h4 {
            color: #28a745;
            margin-top: 0;
        }

        /* Radio button styling */
        .input-field label input[type="radio"] {
            margin-right: 8px;
            margin-left: 0;
            transform: scale(1.2);
        }

        .refresh-summary {
            background: #e3f2fd;
            border: 1px solid #0078d4;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .refresh-summary h4 {
            color: #0078d4;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VMware to Azure VMware Solution Migration ROI Calculator</h1>
            <p>Comprehensive Total Cost of Ownership and Return on Investment Analysis</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('current')">Current Environment</button>
            <button class="tab" onclick="showTab('azure')">Azure VMware Solution</button>
            <button class="tab" onclick="showTab('modernisation')">Modernisation</button>
            <button class="tab" onclick="showTab('migration')">Migration Costs</button>
            <button class="tab" onclick="showTab('documentation')">Documentation</button>
            <button class="tab" onclick="showTab('results')">ROI Analysis</button>
        </div>
        
        <div id="current" class="tab-content active">
            <div class="section">
                <h2>Current On-Premises VMware Environment</h2>
                
                <div class="section">
                    <h3>Cost Calculation Method</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>
                                <input type="radio" name="cost_method" value="fixed" onchange="toggleCostMethod()" checked> 
                                Fixed Annual Cost
                                <span class="info-icon">i
                                    <span class="tooltip">Use a single total annual cost figure for your current on-premises environment. Simpler but less detailed analysis.</span>
                                </span>
                            </label>
                        </div>
                        <div class="input-field">
                            <label>
                                <input type="radio" name="cost_method" value="breakdown" onchange="toggleCostMethod()"> 
                                Detailed Cost Breakdown
                                <span class="info-icon">i
                                    <span class="tooltip">Break down costs into detailed categories for more accurate analysis and better understanding of cost drivers.</span>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <div id="fixed-cost-section" class="section">
                    <h3>Fixed Annual Cost</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Total Annual On-Premises Cost (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Total annual cost of your current VMware environment including hardware, licensing, facilities, staff, and all operational costs.</span>
                                </span>
                            </label>
                            <input type="number" id="fixed_annual_cost" value="548000" step="5000">
                        </div>
                        <div class="input-field">
                            <!-- Empty for grid alignment -->
                        </div>
                    </div>
                </div>

                <div id="breakdown-cost-section" class="section" style="display: none;">
                    <div class="section">
                        <h3>Infrastructure Costs (Annual)</h3>
                        <div class="input-group">
                            <div class="input-field">
                                <label>Hardware Depreciation/Lease (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Annual cost of server hardware including depreciation, leasing, or replacement costs. Include compute servers, storage arrays, and networking hardware.</span>
                                    </span>
                                </label>
                                <input type="number" id="hardware_cost" value="120000" step="1000">
                            </div>
                            <div class="input-field">
                                <label>VMware Licensing (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Annual VMware licensing costs including vSphere, vCenter, vSAN, NSX, and any other VMware products. Include support and subscription costs.</span>
                                    </span>
                                </label>
                                <input type="number" id="vmware_licensing" value="64000" step="1000">
                            </div>
                            <div class="input-field">
                                <label>Storage Hardware (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Annual costs for SAN, NAS, or direct-attached storage including maintenance, support, and replacement reserves.</span>
                                    </span>
                                </label>
                                <input type="number" id="storage_hardware" value="40000" step="1000">
                            </div>
                            <div class="input-field">
                                <label>Network Equipment (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Switches, routers, firewalls, load balancers and other networking infrastructure costs including maintenance and support.</span>
                                    </span>
                                </label>
                                <input type="number" id="network_equipment" value="24000" step="1000">
                            </div>
                            <div class="input-field">
                                <label>Backup Hardware/Software (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Backup software licenses, backup appliances, tape libraries, and offsite storage costs.</span>
                                    </span>
                                </label>
                                <input type="number" id="backup_hardware" value="20000" step="1000">
                            </div>
                            <div class="input-field">
                                <label>Support Contracts (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Hardware support contracts, software maintenance, and third-party support services for your infrastructure.</span>
                                    </span>
                                </label>
                                <input type="number" id="support_contracts" value="48000" step="1000">
                            </div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>Facilities & Operations (Annual)</h3>
                        <div class="input-group">
                            <div class="input-field">
                                <label>Data Centre Space (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Rack space rental, colocation fees, or allocated data centre space costs including security and access.</span>
                                    </span>
                                </label>
                                <input type="number" id="datacenter_space" value="32000" step="1000">
                            </div>
                            <div class="input-field">
                                <label>Power & Cooling (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Electricity costs for servers and infrastructure, UPS systems, cooling/HVAC, and power distribution equipment.</span>
                                    </span>
                                </label>
                                <input type="number" id="power_cooling" value="28000" step="1000">
                            </div>
                            <div class="input-field">
                                <label>Staff Costs (FTE x Salary) (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">Total annual cost of IT staff managing VMware infrastructure including salaries, benefits, training, and contractor costs.</span>
                                    </span>
                                </label>
                                <input type="number" id="staff_costs" value="160000" step="5000">
                            </div>
                            <div class="input-field">
                                <label>Internet/Connectivity (£)
                                    <span class="info-icon">i
                                        <span class="tooltip">ISP costs, dedicated lines, MPLS circuits, and other network connectivity charges.</span>
                                    </span>
                                </label>
                                <input type="number" id="connectivity" value="12000" step="1000">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>Hardware Refresh Planning</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Hardware Purchase Date
                                <span class="info-icon">i
                                    <span class="tooltip">When was the majority of your current hardware purchased? This affects refresh timing and remaining value.</span>
                                </span>
                            </label>
                            <input type="date" id="hardware_purchase_date" value="2020-01-01">
                        </div>
                        <div class="input-field">
                            <label>Hardware Refresh Cycle (Years)
                                <span class="info-icon">i
                                    <span class="tooltip">How often do you typically refresh your hardware? Usually 3-5 years for servers, 5-7 years for storage/network equipment.</span>
                                </span>
                            </label>
                            <input type="number" id="refresh_cycle_years" value="4" step="1" min="1" max="10">
                        </div>
                        <div class="input-field">
                            <label>Refresh Cost Multiplier
                                <span class="info-icon">i
                                    <span class="tooltip">Hardware replacement cost as a multiple of current annual hardware costs. 1.0 = same cost, 1.2 = 20% increase for newer technology.</span>
                                </span>
                            </label>
                            <input type="number" id="refresh_cost_multiplier" value="1.15" step="0.05" min="0.5" max="3.0">
                        </div>
                        <div class="input-field">
                            <label>Percentage to Refresh (%)
                                <span class="info-icon">i
                                    <span class="tooltip">What percentage of your infrastructure will need refreshing? 100% for full refresh, or lower if some equipment is newer.</span>
                                </span>
                            </label>
                            <input type="number" id="refresh_percentage" value="85" step="5" min="0" max="100">
                        </div>
                    </div>
                </div>

                <div id="refresh-summary" class="refresh-summary">
                    <h4>Hardware Refresh Schedule</h4>
                    <p id="refresh-schedule-text">Configure hardware refresh settings above to see the schedule.</p>
                </div>
                
                <div class="section">
                    <h3>Environment Details</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Number of VMs
                                <span class="info-icon">i
                                    <span class="tooltip">Total number of virtual machines currently running in your VMware environment.</span>
                                </span>
                            </label>
                            <input type="number" id="vm_count" value="200" step="10">
                        </div>
                        <div class="input-field">
                            <label>Total vCPUs
                                <span class="info-icon">i
                                    <span class="tooltip">Total number of virtual CPU cores allocated across all VMs.</span>
                                </span>
                            </label>
                            <input type="number" id="total_vcpus" value="800" step="50">
                        </div>
                        <div class="input-field">
                            <label>Total RAM (GB)
                                <span class="info-icon">i
                                    <span class="tooltip">Total amount of RAM allocated to all virtual machines in gigabytes.</span>
                                </span>
                            </label>
                            <input type="number" id="total_ram" value="3200" step="100">
                        </div>
                        <div class="input-field">
                            <label>Total Storage (TB)
                                <span class="info-icon">i
                                    <span class="tooltip">Total storage capacity consumed by all VMs including OS, applications, and data in terabytes.</span>
                                </span>
                            </label>
                            <input type="number" id="total_storage" value="50" step="5">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="azure" class="tab-content">
            <div class="section">
                <h2>Azure VMware Solution Costs</h2>
                
                <div class="section">
                    <h3>AVS Configuration</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>AVS Node Type
                                <span class="info-icon">i
                                    <span class="tooltip">Choose the Azure VMware Solution node type based on your performance requirements. AV36 is standard, AV36P has more RAM, AV52 is high-performance.</span>
                                </span>
                            </label>
                            <select id="avs_node_type">
                                <option value="AV36">AV36 (36 cores, 576GB RAM)</option>
                                <option value="AV36P">AV36P (36 cores, 768GB RAM)</option>
                                <option value="AV52">AV52 (52 cores, 1536GB RAM)</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label>Number of AVS Nodes
                                <span class="info-icon">i
                                    <span class="tooltip">Minimum 3 nodes required for AVS cluster. Size based on your CPU, RAM, and storage requirements with 25% headroom recommended.</span>
                                </span>
                            </label>
                            <input type="number" id="avs_nodes" value="6" step="1" min="3">
                        </div>
                        <div class="input-field">
                            <label>Reserved Instance Term
                                <span class="info-icon">i
                                    <span class="tooltip">Reserved instances provide significant discounts. 1-year offers ~20% savings, 3-year offers ~40% savings versus pay-as-you-go.</span>
                                </span>
                            </label>
                            <select id="reserved_term">
                                <option value="payg">Pay-as-you-go</option>
                                <option value="1year">1 Year Reserved</option>
                                <option value="3year">3 Year Reserved</option>
                            </select>
                        </div>
                        <div class="input-field">
                            <label>Azure Hybrid Benefit
                                <span class="info-icon">i
                                    <span class="tooltip">Use existing Windows Server and SQL Server licenses in Azure for additional savings. Requires Software Assurance.</span>
                                </span>
                            </label>
                            <select id="hybrid_benefit">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>Additional Azure Services (Monthly)</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>ExpressRoute (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Dedicated private network connection to Azure. Required for production AVS deployments. Cost depends on bandwidth (1Gbps, 10Gbps, etc.)</span>
                                </span>
                            </label>
                            <input type="number" id="expressroute" value="400" step="50">
                        </div>
                        <div class="input-field">
                            <label>Azure Backup (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Azure Backup service costs based on protected data volume and retention requirements.</span>
                                </span>
                            </label>
                            <input type="number" id="azure_backup" value="640" step="50">
                        </div>
                        <div class="input-field">
                            <label>Data Transfer (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Outbound data transfer charges for internet traffic, VPN connections, and cross-region replication.</span>
                                </span>
                            </label>
                            <input type="number" id="data_transfer" value="240" step="50">
                        </div>
                        <div class="input-field">
                            <label>Monitoring & Management (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Azure Monitor, Log Analytics, Security Center, and other management tool costs.</span>
                                </span>
                            </label>
                            <input type="number" id="monitoring" value="320" step="50">
                        </div>
                        <div class="input-field">
                            <label>Additional Storage (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Extra storage beyond what's included with AVS nodes, such as Azure NetApp Files or additional vSAN storage.</span>
                                </span>
                            </label>
                            <input type="number" id="additional_storage" value="480" step="50">
                        </div>
                        <div class="input-field">
                            <label>Security Services (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Azure Security Center, Sentinel, Key Vault, and other security services.</span>
                                </span>
                            </label>
                            <input type="number" id="security_services" value="240" step="50">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="modernisation" class="tab-content">
            <div class="section">
                <h2>Cloud Modernisation Opportunities</h2>
                <p>Identify workloads that can be modernised to native Azure services instead of running on AVS, reducing licensing and infrastructure costs.</p>
                
                <div class="section">
                    <h3>Application Modernisation</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>VMs Moving to Azure VMs (%)
                                <span class="info-icon">i
                                    <span class="tooltip">Percentage of current VMs that can move to native Azure VMs instead of AVS. These will use Azure compute pricing instead of VMware licensing.</span>
                                </span>
                            </label>
                            <input type="number" id="vms_to_azure" value="30" step="5" min="0" max="100">
                        </div>
                        <div class="input-field">
                            <label>Applications to PaaS (Count)
                                <span class="info-icon">i
                                    <span class="tooltip">Number of applications that can move to Platform-as-a-Service (App Service, Functions, etc.) eliminating the need for VM infrastructure.</span>
                                </span>
                            </label>
                            <input type="number" id="apps_to_paas" value="15" step="1" min="0">
                        </div>
                        <div class="input-field">
                            <label>Databases to Managed Services (Count)
                                <span class="info-icon">i
                                    <span class="tooltip">Number of database VMs moving to Azure SQL Database, MySQL, PostgreSQL, or Cosmos DB managed services.</span>
                                </span>
                            </label>
                            <input type="number" id="databases_to_managed" value="8" step="1" min="0">
                        </div>
                        <div class="input-field">
                            <label>File Servers to Azure Files (Count)
                                <span class="info-icon">i
                                    <span class="tooltip">Number of file server VMs that can be replaced with Azure Files or Azure NetApp Files.</span>
                                </span>
                            </label>
                            <input type="number" id="fileservers_to_azure" value="5" step="1" min="0">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Modernisation Impact</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>AVS Node Reduction (Count)
                                <span class="info-icon">i
                                    <span class="tooltip">Number of AVS nodes that can be eliminated through modernisation efforts. Each node saves significant licensing and infrastructure costs.</span>
                                </span>
                            </label>
                            <input type="number" id="nodes_saved" value="2" step="1" min="0">
                        </div>
                        <div class="input-field">
                            <label>VMware License Reduction (%)
                                <span class="info-icon">i
                                    <span class="tooltip">Percentage reduction in VMware licensing costs due to workloads moving to native Azure services.</span>
                                </span>
                            </label>
                            <input type="number" id="license_reduction" value="25" step="5" min="0" max="100">
                        </div>
                        <div class="input-field">
                            <label>Modernisation Timeline (Months)
                                <span class="info-icon">i
                                    <span class="tooltip">Time to complete modernisation efforts after initial migration. Savings will begin after this period.</span>
                                </span>
                            </label>
                            <input type="number" id="modernisation_timeline" value="12" step="1" min="0" max="36">
                        </div>
                        <div class="input-field">
                            <label>Modernisation Investment (£)
                                <span class="info-icon">i
                                    <span class="tooltip">One-time cost for application refactoring, data migration, training, and professional services for modernisation.</span>
                                </span>
                            </label>
                            <input type="number" id="modernisation_investment" value="50000" step="5000">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Native Azure Service Costs (Monthly)</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Azure VMs Cost (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Estimated monthly cost for VMs moving to native Azure compute (without AVS). Use Azure calculator for accurate pricing.</span>
                                </span>
                            </label>
                            <input type="number" id="azure_vms_cost" value="1200" step="100">
                        </div>
                        <div class="input-field">
                            <label>PaaS Services Cost (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Monthly cost for App Service, Functions, and other PaaS services replacing traditional applications.</span>
                                </span>
                            </label>
                            <input type="number" id="paas_cost" value="800" step="50">
                        </div>
                        <div class="input-field">
                            <label>Managed Database Cost (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Monthly cost for Azure SQL Database, MySQL, PostgreSQL, and other managed database services.</span>
                                </span>
                            </label>
                            <input type="number" id="managed_db_cost" value="600" step="50">
                        </div>
                        <div class="input-field">
                            <label>Azure Storage Cost (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Monthly cost for Azure Files, Blob Storage, and other storage services replacing file servers.</span>
                                </span>
                            </label>
                            <input type="number" id="azure_storage_cost" value="200" step="25">
                        </div>
                    </div>
                </div>

                <div class="modernisation-summary">
                    <h4>Modernisation Benefits</h4>
                    <p>By modernising applications to native Azure services, you can:</p>
                    <ul>
                        <li>Reduce VMware licensing costs</li>
                        <li>Decrease AVS node requirements</li>
                        <li>Improve scalability and resilience</li>
                        <li>Access cloud-native features and services</li>
                        <li>Reduce operational overhead</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="migration" class="tab-content">
            <div class="section">
                <h2>Migration Investment</h2>
                
                <div class="section">
                    <h3>One-Time Migration Costs</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Assessment & Planning (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Cost for migration assessment, planning, and design including discovery tools, workshops, and architecture design.</span>
                                </span>
                            </label>
                            <input type="number" id="assessment" value="20000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Migration Tools & Services (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Azure Migrate, HCX licensing, replication tools, and other migration software costs.</span>
                                </span>
                            </label>
                            <input type="number" id="migration_tools" value="32000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Professional Services (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Microsoft or partner professional services for migration execution, testing, and cutover support.</span>
                                </span>
                            </label>
                            <input type="number" id="professional_services" value="64000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Training & Certification (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Azure training for IT staff, certification costs, and knowledge transfer sessions.</span>
                                </span>
                            </label>
                            <input type="number" id="training" value="12000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Downtime/Business Impact (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Estimated cost of business downtime during migration cutover windows and any productivity impacts.</span>
                                </span>
                            </label>
                            <input type="number" id="downtime_cost" value="24000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Contingency (% of above)
                                <span class="info-icon">i
                                    <span class="tooltip">Contingency buffer for unexpected costs, scope changes, or extended timelines. 10-20% is typical.</span>
                                </span>
                            </label>
                            <input type="number" id="contingency" value="10" step="1" min="0" max="50">
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>Cloud Partner Funding & Incentives</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Microsoft Partner Migration Funding (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Migration funding provided by Microsoft to qualified partners. Typically £10,000-£50,000+ depending on migration size and partner level.</span>
                                </span>
                            </label>
                            <input type="number" id="migration_funding" value="25000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Azure Consumption Credits (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Azure credits provided to offset initial consumption costs. Often £5,000-£25,000 for qualified migrations.</span>
                                </span>
                            </label>
                            <input type="number" id="azure_credits" value="15000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Professional Services Funding (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Funding for partner professional services, workshops, and migration support. Varies by partner tier and project scope.</span>
                                </span>
                            </label>
                            <input type="number" id="professional_services_funding" value="20000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Training & Certification Funding (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Microsoft funding for Azure training and certification programs for customer IT staff.</span>
                                </span>
                            </label>
                            <input type="number" id="training_funding" value="5000" step="1000">
                        </div>
                        <div class="input-field">
                            <label>Additional Partner Incentives (£)
                                <span class="info-icon">i
                                    <span class="tooltip">Other partner incentives such as go-to-market funding, marketing co-op, or special migration programs.</span>
                                </span>
                            </label>
                            <input type="number" id="additional_incentives" value="10000" step="1000">
                        </div>
                        <div class="input-field">
                            <!-- Empty for grid alignment -->
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Migration Timeline</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Migration Timeline (Months)
                                <span class="info-icon">i
                                    <span class="tooltip">Time to complete initial migration to AVS. Modernisation timeline is configured in the Modernisation tab.</span>
                                </span>
                            </label>
                            <input type="number" id="migration_timeline" value="6" step="1" min="1" max="24">
                        </div>
                        <div class="input-field">
                            <!-- Empty for grid alignment -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="documentation" class="tab-content">
            <div class="section">
                <h2>Calculation Methodology & Documentation</h2>
                <p>This calculator uses established financial analysis methods to evaluate the Total Cost of Ownership (TCO) and Return on Investment (ROI) for migrating from on-premises VMware to Azure VMware Solution.</p>
                
                <div class="section">
                    <h3>Core Financial Formulas</h3>
                    
                    <div class="formula-box">
                        <h4>1. Return on Investment (ROI)</h4>
                        <p><strong>ROI = [(Total Savings - Total Investment) / Total Investment] × 100</strong></p>
                        <p><strong>Where:</strong></p>
                        <ul>
                            <li><strong>Total Savings:</strong> Sum of annual cost savings over the analysis period</li>
                            <li><strong>Total Investment:</strong> Net migration costs after partner funding</li>
                        </ul>
                    </div>

                    <div class="formula-box">
                        <h4>2. Payback Period</h4>
                        <p><strong>Payback Period = Time when Cumulative Savings ≥ Total Investment</strong></p>
                        <p>Simple calculation showing when the investment will be recovered through cost savings.</p>
                    </div>

                    <div class="formula-box">
                        <h4>3. Total Cost Savings</h4>
                        <p><strong>Total Savings = Σ(t=1 to n) [Annual Savings in Year t]</strong></p>
                        <p>Sum of all cost savings over the analysis period, accounting for growth and modernisation.</p>
                    </div>

                    <div class="formula-box">
                        <h4>4. Migration Investment with Partner Funding</h4>
                        <p><strong>Gross Investment = (Base Migration Costs × (1 + Contingency%)) + Modernisation Investment</strong></p>
                        <p><strong>Partner Funding = Migration Funding + Azure Credits + Services Funding + Training Funding + Additional Incentives</strong></p>
                        <p><strong>Net Investment = Max(0, Gross Investment - Partner Funding)</strong></p>
                        <p><strong>Where:</strong></p>
                        <ul>
                            <li><strong>Base Migration Costs:</strong> Assessment + Tools + Professional Services + Training + Downtime</li>
                            <li><strong>Partner Funding:</strong> Total funding and incentives from Microsoft and partners</li>
                            <li><strong>Net Investment:</strong> Actual customer investment after applying all funding</li>
                        </ul>
                    </div>
                </div>

                <div class="section">
                    <h3>Cost Calculation Methods</h3>
                    
                    <div class="formula-box">
                        <h4>Method 1: Fixed Annual Cost</h4>
                        <p>Uses a single total annual cost figure for your current environment.</p>
                        <p><strong>On-Premises Annual Cost = Fixed Annual Cost</strong></p>
                        <p><strong>Hardware Portion = 50% of Fixed Cost</strong> (used for refresh calculations)</p>
                    </div>

                    <div class="formula-box">
                        <h4>Method 2: Detailed Cost Breakdown</h4>
                        <p><strong>On-Premises Annual Cost = Infrastructure + Operations</strong></p>
                        <p><strong>Infrastructure:</strong> Hardware + VMware Licensing + Storage + Network + Backup + Support</p>
                        <p><strong>Operations:</strong> Data Centre + Power/Cooling + Staff + Connectivity</p>
                        <p><strong>Hardware Portion:</strong> Hardware + Storage + Network Equipment</p>
                    </div>
                </div>

                <div class="section">
                    <h3>Growth and Timing Calculations</h3>
                    
                    <div class="formula-box">
                        <h4>Annual Cost Growth</h4>
                        <p><strong>Cost in Year t = Base Cost × (1 + Growth Rate)^(t-1)</strong></p>
                        <p>Applied to both on-premises and Azure costs to account for inflation and business growth.</p>
                    </div>

                    <div class="formula-box">
                        <h4>Hardware Refresh Costs</h4>
                        <p><strong>Refresh Cost = Hardware Portion × Cost Multiplier × (Refresh % / 100)</strong></p>
                        <p><strong>Refresh Timing:</strong> Based on hardware age and refresh cycle</p>
                        <p><strong>Current Age = (Today - Purchase Date) / 365.25 days</strong></p>
                        <p><strong>Next Refresh = Ceiling(Current Age / Cycle) × Cycle</strong></p>
                    </div>

                    <div class="formula-box">
                        <h4>Modernisation Timeline</h4>
                        <p><strong>Modernisation Start Year = Ceiling(Timeline in Months / 12)</strong></p>
                        <p>Savings from node reduction and native Azure services begin after this period.</p>
                    </div>
                </div>

                <div class="section">
                    <h3>Azure Cost Components</h3>
                    
                    <div class="formula-box">
                        <h4>AVS Node Costs</h4>
                        <p><strong>Monthly AVS Cost = Node Cost × Number of Nodes × Pricing Tier</strong></p>
                        <p><strong>Pricing Tiers:</strong></p>
                        <ul>
                            <li>Pay-as-you-go: Full price</li>
                            <li>1-Year Reserved: ~20% discount</li>
                            <li>3-Year Reserved: ~40% discount</li>
                        </ul>
                        <p><strong>Azure Hybrid Benefit:</strong> ~40% additional savings on compute portion</p>
                    </div>

                    <div class="formula-box">
                        <h4>Total Azure Annual Cost</h4>
                        <p><strong>Annual Azure Cost = (AVS Nodes + Additional Services) × 12</strong></p>
                        <p><strong>Additional Services:</strong> ExpressRoute + Backup + Data Transfer + Monitoring + Storage + Security</p>
                    </div>
                </div>

                <div class="section">
                    <h3>Key Input Categories</h3>
                    
                    <div class="breakdown">
                        <table class="breakdown-table">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Key Inputs</th>
                                    <th>Impact on Calculation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Current Environment</strong></td>
                                    <td>Cost method, hardware/software costs, staff costs, facilities</td>
                                    <td>Determines baseline annual costs and hardware refresh schedule</td>
                                </tr>
                                <tr>
                                    <td><strong>Hardware Refresh</strong></td>
                                    <td>Purchase date, refresh cycle, cost multiplier, percentage</td>
                                    <td>Calculates timing and cost of on-premises hardware refreshes</td>
                                </tr>
                                <tr>
                                    <td><strong>Azure Configuration</strong></td>
                                    <td>Node type, count, reserved terms, hybrid benefits</td>
                                    <td>Determines base Azure VMware Solution costs</td>
                                </tr>
                                <tr>
                                    <td><strong>Azure Services</strong></td>
                                    <td>ExpressRoute, backup, monitoring, security services</td>
                                    <td>Additional monthly Azure service costs</td>
                                </tr>
                                <tr>
                                    <td><strong>Modernisation</strong></td>
                                    <td>VMs to migrate, applications to modernise, timeline</td>
                                    <td>Calculates savings from moving to native Azure services</td>
                                </tr>
                                <tr>
                                    <td><strong>Migration Investment</strong></td>
                                    <td>Assessment, tools, services, training, contingency</td>
                                    <td>One-time costs that must be recovered through savings</td>
                                </tr>
                                <tr>
                                    <td><strong>Partner Funding</strong></td>
                                    <td>Microsoft funding, Azure credits, services funding, training funding</td>
                                    <td>Reduces net migration investment and improves ROI</td>
                                </tr>
                                <tr>
                                    <td><strong>Financial Analysis Parameters</strong></td>
                                    <td>Analysis period, growth rate</td>
                                    <td>Controls analysis timeframe and cost growth projections</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="section">
                    <h3>Assumptions and Limitations</h3>
                    
                    <div class="formula-box">
                        <h4>Key Assumptions</h4>
                        <ul>
                            <li><strong>Fixed Cost Method:</strong> Hardware represents 50% of total costs</li>
                            <li><strong>Staff Reduction:</strong> 30% reduction in staff costs with Azure (breakdown method)</li>
                            <li><strong>Growth Rates:</strong> Applied equally to on-premises and Azure costs</li>
                            <li><strong>Hardware Refresh:</strong> Occurs when equipment reaches refresh cycle age</li>
                            <li><strong>Modernisation:</strong> Savings begin after modernisation timeline</li>
                            <li><strong>Simple Calculations:</strong> No discounting or time value of money adjustments</li>
                            <li><strong>Currency:</strong> All costs in GBP (£)</li>
                        </ul>
                    </div>

                    <div class="formula-box">
                        <h4>Limitations</h4>
                        <ul>
                            <li>Does not include intangible benefits (agility, innovation, scalability)</li>
                            <li>Azure pricing is estimated and may vary by region and contract terms</li>
                            <li>Assumes steady-state operations after migration completion</li>
                            <li>Does not account for business disruption during migration</li>
                            <li>Hardware refresh timing assumes uniform equipment age</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="results" class="tab-content">
            <div class="section">
                <h2>ROI Analysis & Calculations</h2>
                
                <div class="formula-box">
                    <h4>Financial Analysis Formulas</h4>
                    <p><strong>ROI = (Total Savings - Total Investment) / Total Investment × 100</strong></p>
                    <p><strong>Payback Period = Time when Cumulative Savings ≥ Total Investment</strong></p>
                    <p><strong>Annual Growth = Cost in Year t = Base Cost × (1 + Growth Rate)^(t-1)</strong></p>
                </div>

                <div class="section">
                    <h3>Financial Analysis Parameters</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Analysis Period (Years)
                                <span class="info-icon">i
                                    <span class="tooltip">Time period for ROI analysis. Typically 3-5 years to capture full benefits of cloud migration.</span>
                                </span>
                            </label>
                            <input type="number" id="analysis_period" value="5" step="1" min="1" max="10">
                        </div>

                        <div class="input-field">
                            <label>Annual Growth Rate (%)
                                <span class="info-icon">i
                                    <span class="tooltip">Expected annual growth in IT costs due to inflation, capacity growth, and business expansion.</span>
                                </span>
                            </label>
                            <input type="number" id="growth_rate" value="3" step="0.5" min="0" max="15">
                        </div>
                        <div class="input-field">
                            <!-- Empty for grid alignment -->
                        </div>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateROI()">Calculate ROI & TCO</button>
                
                <div id="roi-results" class="results" style="display: none;">
                    <h2>Financial Analysis Results</h2>
                    
                    <div class="metric">
                        <span class="metric-label">Return on Investment (ROI)</span>
                        <span class="metric-value" id="roi-percentage">0%</span>
                    </div>
                    
                    <div class="metric">
                        <span class="metric-label">Payback Period</span>
                        <span class="metric-value" id="payback-period">0 years</span>
                    </div>
                    
                    <div class="metric">
                        <span class="metric-label">Total Cost Savings</span>
                        <span class="metric-value positive" id="total-savings">£0</span>
                    </div>
                    
                    <div class="metric">
                        <span class="metric-label">Gross Investment</span>
                        <span class="metric-value" id="gross-investment">£0</span>
                    </div>
                    
                    <div class="metric">
                        <span class="metric-label">Partner Funding</span>
                        <span class="metric-value funding" id="partner-funding">£0</span>
                    </div>
                    
                    <div class="metric">
                        <span class="metric-label">Net Investment</span>
                        <span class="metric-value" id="total-investment">£0</span>
                    </div>
                    
                    <div class="metric">
                        <span class="metric-label">Total Benefits (5 Years)</span>
                        <span class="metric-value" id="total-benefits">£0</span>
                    </div>

                    <div class="metric">
                        <span class="metric-label">Modernisation Savings (5 Years)</span>
                        <span class="metric-value positive" id="modernisation-savings">£0</span>
                    </div>
                    
                    <div class="breakdown">
                        <h3>Annual Cost Comparison</h3>
                        <table class="breakdown-table">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>On-Premises Cost</th>
                                    <th>Hardware Refresh</th>
                                    <th>Azure Cost</th>
                                    <th>Modernisation Savings</th>
                                    <th>Annual Savings</th>
                                    <th>Cumulative Savings</th>
                                </tr>
                            </thead>
                            <tbody id="yearly-breakdown">
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="breakdown">
                        <h3>Cost Breakdown Summary</h3>
                        <table class="breakdown-table">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>On-Premises (Annual)</th>
                                    <th>Azure (Annual)</th>
                                    <th>Difference</th>
                                </tr>
                            </thead>
                            <tbody id="cost-breakdown">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

                 function toggleCostMethod() {
             const fixedCostSection = document.getElementById('fixed-cost-section');
             const breakdownCostSection = document.getElementById('breakdown-cost-section');
             const fixedCostInput = document.getElementById('fixed_annual_cost');
             const breakdownInputs = document.querySelectorAll('#breakdown-cost-section .input-field input');

             if (document.querySelector('input[name="cost_method"]:checked').value === 'fixed') {
                 fixedCostSection.style.display = 'block';
                 breakdownCostSection.style.display = 'none';
                 fixedCostInput.setAttribute('required', 'required');
                 breakdownInputs.forEach(input => input.removeAttribute('required'));
             } else {
                 fixedCostSection.style.display = 'none';
                 breakdownCostSection.style.display = 'block';
                 fixedCostInput.removeAttribute('required');
                 breakdownInputs.forEach(input => input.setAttribute('required', 'required'));
             }
             updateRefreshSchedule();
         }

         function updateRefreshSchedule() {
             const purchaseDateInput = document.getElementById('hardware_purchase_date');
             const refreshCycleInput = document.getElementById('refresh_cycle_years');
             const refreshPercentageInput = document.getElementById('refresh_percentage');
             const refreshMultiplierInput = document.getElementById('refresh_cost_multiplier');
             
             if (!purchaseDateInput.value || !refreshCycleInput.value) {
                 document.getElementById('refresh-schedule-text').textContent = 'Configure hardware refresh settings above to see the schedule.';
                 return;
             }

             const purchaseDate = new Date(purchaseDateInput.value);
             const currentDate = new Date();
             const refreshCycle = parseInt(refreshCycleInput.value);
             const refreshPercentage = parseFloat(refreshPercentageInput.value);
             const refreshMultiplier = parseFloat(refreshMultiplierInput.value);
             
             const yearsOld = (currentDate - purchaseDate) / (1000 * 60 * 60 * 24 * 365.25);
             const nextRefreshAge = Math.ceil(yearsOld / refreshCycle) * refreshCycle;
             const yearsUntilRefresh = nextRefreshAge - yearsOld;
             
             const nextRefreshDate = new Date(currentDate);
             nextRefreshDate.setFullYear(nextRefreshDate.getFullYear() + yearsUntilRefresh);
             
             let scheduleText = `Hardware is ${yearsOld.toFixed(1)} years old. `;
             
             if (yearsUntilRefresh < 1) {
                 scheduleText += `Next refresh is due now! `;
             } else {
                 scheduleText += `Next refresh due in ${yearsUntilRefresh.toFixed(1)} years (${nextRefreshDate.getFullYear()}). `;
             }
             
             scheduleText += `${refreshPercentage}% of hardware will be refreshed at ${((refreshMultiplier - 1) * 100).toFixed(0)}% cost increase.`;
             
             document.getElementById('refresh-schedule-text').textContent = scheduleText;
         }

         // Add event listeners for refresh schedule updates
         document.addEventListener('DOMContentLoaded', function() {
             document.getElementById('hardware_purchase_date').addEventListener('change', updateRefreshSchedule);
             document.getElementById('refresh_cycle_years').addEventListener('input', updateRefreshSchedule);
             document.getElementById('refresh_percentage').addEventListener('input', updateRefreshSchedule);
             document.getElementById('refresh_cost_multiplier').addEventListener('input', updateRefreshSchedule);
             
             // Initial update
             updateRefreshSchedule();
         });

        function calculateROI() {
            // Get cost calculation method
            const costMethod = document.querySelector('input[name="cost_method"]:checked').value;
            
            // Get all input values
            const inputs = {
                // Cost method and fixed cost
                cost_method: costMethod,
                fixed_annual_cost: parseFloat(document.getElementById('fixed_annual_cost').value) || 0,
                
                // Current environment costs (breakdown method)
                hardware_cost: parseFloat(document.getElementById('hardware_cost').value) || 0,
                vmware_licensing: parseFloat(document.getElementById('vmware_licensing').value) || 0,
                storage_hardware: parseFloat(document.getElementById('storage_hardware').value) || 0,
                network_equipment: parseFloat(document.getElementById('network_equipment').value) || 0,
                backup_hardware: parseFloat(document.getElementById('backup_hardware').value) || 0,
                support_contracts: parseFloat(document.getElementById('support_contracts').value) || 0,
                datacenter_space: parseFloat(document.getElementById('datacenter_space').value) || 0,
                power_cooling: parseFloat(document.getElementById('power_cooling').value) || 0,
                staff_costs: parseFloat(document.getElementById('staff_costs').value) || 0,
                connectivity: parseFloat(document.getElementById('connectivity').value) || 0,
                
                // Hardware refresh planning
                hardware_purchase_date: document.getElementById('hardware_purchase_date').value,
                refresh_cycle_years: parseInt(document.getElementById('refresh_cycle_years').value) || 4,
                refresh_cost_multiplier: parseFloat(document.getElementById('refresh_cost_multiplier').value) || 1.15,
                refresh_percentage: parseFloat(document.getElementById('refresh_percentage').value) || 85,
                
                // Azure costs
                avs_node_type: document.getElementById('avs_node_type').value,
                avs_nodes: parseInt(document.getElementById('avs_nodes').value) || 3,
                reserved_term: document.getElementById('reserved_term').value,
                hybrid_benefit: document.getElementById('hybrid_benefit').value,
                expressroute: parseFloat(document.getElementById('expressroute').value) || 0,
                azure_backup: parseFloat(document.getElementById('azure_backup').value) || 0,
                data_transfer: parseFloat(document.getElementById('data_transfer').value) || 0,
                monitoring: parseFloat(document.getElementById('monitoring').value) || 0,
                additional_storage: parseFloat(document.getElementById('additional_storage').value) || 0,
                security_services: parseFloat(document.getElementById('security_services').value) || 0,
                
                // Modernisation inputs
                vms_to_azure: parseFloat(document.getElementById('vms_to_azure').value) || 0,
                apps_to_paas: parseInt(document.getElementById('apps_to_paas').value) || 0,
                databases_to_managed: parseInt(document.getElementById('databases_to_managed').value) || 0,
                fileservers_to_azure: parseInt(document.getElementById('fileservers_to_azure').value) || 0,
                nodes_saved: parseInt(document.getElementById('nodes_saved').value) || 0,
                license_reduction: parseFloat(document.getElementById('license_reduction').value) || 0,
                modernisation_timeline: parseInt(document.getElementById('modernisation_timeline').value) || 12,
                modernisation_investment: parseFloat(document.getElementById('modernisation_investment').value) || 0,
                azure_vms_cost: parseFloat(document.getElementById('azure_vms_cost').value) || 0,
                paas_cost: parseFloat(document.getElementById('paas_cost').value) || 0,
                managed_db_cost: parseFloat(document.getElementById('managed_db_cost').value) || 0,
                azure_storage_cost: parseFloat(document.getElementById('azure_storage_cost').value) || 0,
                
                // Migration costs
                assessment: parseFloat(document.getElementById('assessment').value) || 0,
                migration_tools: parseFloat(document.getElementById('migration_tools').value) || 0,
                professional_services: parseFloat(document.getElementById('professional_services').value) || 0,
                training: parseFloat(document.getElementById('training').value) || 0,
                downtime_cost: parseFloat(document.getElementById('downtime_cost').value) || 0,
                contingency: parseFloat(document.getElementById('contingency').value) || 0,
                
                // Partner funding & incentives
                migration_funding: parseFloat(document.getElementById('migration_funding').value) || 0,
                azure_credits: parseFloat(document.getElementById('azure_credits').value) || 0,
                professional_services_funding: parseFloat(document.getElementById('professional_services_funding').value) || 0,
                training_funding: parseFloat(document.getElementById('training_funding').value) || 0,
                additional_incentives: parseFloat(document.getElementById('additional_incentives').value) || 0,
                
                // Analysis parameters
                analysis_period: parseInt(document.getElementById('analysis_period').value) || 5,
                growth_rate: parseFloat(document.getElementById('growth_rate').value) || 3,
                migration_timeline: parseInt(document.getElementById('migration_timeline').value) || 6
            };

            // Calculate annual on-premises costs based on method
            let baseAnnualOnPremCosts;
            let hardwareRelatedCosts;
            
            if (inputs.cost_method === 'fixed') {
                baseAnnualOnPremCosts = inputs.fixed_annual_cost;
                // Estimate hardware portion as 50% of total for refresh calculations
                hardwareRelatedCosts = baseAnnualOnPremCosts * 0.5;
            } else {
                baseAnnualOnPremCosts = inputs.hardware_cost + inputs.vmware_licensing + 
                    inputs.storage_hardware + inputs.network_equipment + inputs.backup_hardware + 
                    inputs.support_contracts + inputs.datacenter_space + inputs.power_cooling + 
                    inputs.staff_costs + inputs.connectivity;
                hardwareRelatedCosts = inputs.hardware_cost + inputs.storage_hardware + inputs.network_equipment;
            }

            // Calculate hardware refresh timing and costs
            const purchaseDate = new Date(inputs.hardware_purchase_date);
            const currentDate = new Date();
            const yearsOld = (currentDate - purchaseDate) / (1000 * 60 * 60 * 24 * 365.25);
            
            function calculateRefreshCosts(year) {
                const ageAtYear = yearsOld + year;
                const refreshYear = Math.ceil(ageAtYear / inputs.refresh_cycle_years) * inputs.refresh_cycle_years;
                
                // Check if refresh occurs in this year
                if (Math.abs(refreshYear - ageAtYear) < 0.5) {
                    const refreshCost = hardwareRelatedCosts * inputs.refresh_cost_multiplier * (inputs.refresh_percentage / 100);
                    return refreshCost;
                }
                return 0;
            }

            // Calculate AVS node costs based on type and terms (converted to GBP, roughly)
            const nodeCosts = {
                'AV36': { payg: 7000, '1year': 5600, '3year': 4200 },
                'AV36P': { payg: 9350, '1year': 7480, '3year': 5610 },
                'AV52': { payg: 14000, '1year': 11200, '3year': 8400 }
            };

            let monthlyAvsNodeCost = nodeCosts[inputs.avs_node_type][inputs.reserved_term] * inputs.avs_nodes;
            
            // Apply Azure Hybrid Benefit (approximately 40% savings on compute)
            if (inputs.hybrid_benefit === 'yes') {
                monthlyAvsNodeCost *= 0.6;
            }

            // Calculate total monthly Azure costs
            const monthlyAzureCosts = monthlyAvsNodeCost + inputs.expressroute + inputs.azure_backup + 
                inputs.data_transfer + inputs.monitoring + inputs.additional_storage + inputs.security_services;

            let annualAzureCosts = monthlyAzureCosts * 12;

            // Calculate modernisation costs and savings
            const annualModernisationServiceCosts = (inputs.azure_vms_cost + inputs.paas_cost + 
                inputs.managed_db_cost + inputs.azure_storage_cost) * 12;

            // Calculate migration investment including modernisation
            const migrationCosts = inputs.assessment + inputs.migration_tools + inputs.professional_services + 
                inputs.training + inputs.downtime_cost;
            const grossMigrationCosts = migrationCosts * (1 + inputs.contingency / 100) + inputs.modernisation_investment;
            
            // Calculate total partner funding and incentives
            const totalPartnerFunding = inputs.migration_funding + inputs.azure_credits + 
                inputs.professional_services_funding + inputs.training_funding + inputs.additional_incentives;
            
            // Net migration costs after partner funding
            const totalMigrationCosts = Math.max(0, grossMigrationCosts - totalPartnerFunding);

            // Calculate savings and ROI with modernisation timeline
            let totalBenefits = 0;
            let totalModernisationSavings = 0;
            const growthRate = inputs.growth_rate / 100;
            const modernisationStartYear = Math.ceil(inputs.modernisation_timeline / 12);

            const yearlyBreakdown = [];
            let cumulativeSavings = 0;

            for (let year = 1; year <= inputs.analysis_period; year++) {
                let yearlyOnPremCost = baseAnnualOnPremCosts * Math.pow(1 + growthRate, year - 1);
                
                // Add hardware refresh costs if they occur this year
                const refreshCost = calculateRefreshCosts(year);
                yearlyOnPremCost += refreshCost;
                
                let yearlyAzureCost = annualAzureCosts * Math.pow(1 + growthRate, year - 1);
                let modernisationSavingsThisYear = 0;

                // Apply modernisation savings after the modernisation timeline
                if (year >= modernisationStartYear) {
                    // Reduce AVS costs by saved nodes
                    const nodeCostPerYear = nodeCosts[inputs.avs_node_type][inputs.reserved_term] * 12;
                    const nodesSavings = inputs.nodes_saved * nodeCostPerYear * Math.pow(1 + growthRate, year - 1);
                    
                    // Add native Azure service costs
                    const additionalAzureCosts = annualModernisationServiceCosts * Math.pow(1 + growthRate, year - 1);
                    
                    modernisationSavingsThisYear = nodesSavings - additionalAzureCosts;
                    yearlyAzureCost -= nodesSavings;
                    yearlyAzureCost += additionalAzureCosts;
                    
                    totalModernisationSavings += modernisationSavingsThisYear;
                }
                
                const yearlySavings = yearlyOnPremCost - yearlyAzureCost;
                
                totalBenefits += yearlySavings;
                cumulativeSavings += yearlySavings;

                yearlyBreakdown.push({
                    year: year,
                    onPremCost: yearlyOnPremCost,
                    azureCost: yearlyAzureCost,
                    refreshCost: refreshCost,
                    modernisationSavings: modernisationSavingsThisYear,
                    savings: yearlySavings,
                    cumulative: cumulativeSavings
                });
            }

            const roi = ((totalBenefits - totalMigrationCosts) / totalMigrationCosts) * 100;
            const annualSavings = totalBenefits / inputs.analysis_period;
            
            // Calculate simple payback period using cumulative savings
            function calculateSimplePaybackPeriod(totalMigrationCosts, yearlyBreakdown) {
                let cumulativeSavings = 0;
                
                for (let i = 0; i < yearlyBreakdown.length; i++) {
                    const year = yearlyBreakdown[i];
                    cumulativeSavings += year.savings;
                    
                    if (cumulativeSavings >= totalMigrationCosts) {
                        // Linear interpolation for more precise payback period
                        const previousCumulative = cumulativeSavings - year.savings;
                        const remainingAmount = totalMigrationCosts - previousCumulative;
                        const fractionOfYear = remainingAmount / year.savings;
                        
                        return (year.year - 1) + fractionOfYear;
                    }
                }
                
                // If payback period exceeds analysis period
                return -1; // Indicates no payback within analysis period
            }
            
            const paybackPeriod = calculateSimplePaybackPeriod(totalMigrationCosts, yearlyBreakdown);

            // Display results
            document.getElementById('roi-percentage').textContent = roi.toFixed(1) + '%';
            document.getElementById('roi-percentage').className = 'metric-value ' + (roi > 0 ? 'positive' : 'negative');
            
            document.getElementById('payback-period').textContent = paybackPeriod === -1 ? 
                'No payback within analysis period' : paybackPeriod.toFixed(1) + ' years';
            
            document.getElementById('total-savings').textContent = '£' + totalBenefits.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('gross-investment').textContent = '£' + grossMigrationCosts.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('partner-funding').textContent = '£' + totalPartnerFunding.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('total-investment').textContent = '£' + totalMigrationCosts.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('total-benefits').textContent = '£' + totalBenefits.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('modernisation-savings').textContent = '£' + totalModernisationSavings.toLocaleString(undefined, {maximumFractionDigits: 0});

            // Populate yearly breakdown table
            const yearlyTable = document.getElementById('yearly-breakdown');
            yearlyTable.innerHTML = '';
            yearlyBreakdown.forEach(year => {
                const row = yearlyTable.insertRow();
                row.insertCell(0).textContent = year.year;
                row.insertCell(1).textContent = '£' + year.onPremCost.toLocaleString(undefined, {maximumFractionDigits: 0});
                
                const refreshCell = row.insertCell(2);
                refreshCell.textContent = '£' + year.refreshCost.toLocaleString(undefined, {maximumFractionDigits: 0});
                if (year.refreshCost > 0) {
                    refreshCell.style.backgroundColor = '#fff3cd';
                    refreshCell.style.color = '#856404';
                    refreshCell.style.fontWeight = 'bold';
                }
                
                row.insertCell(3).textContent = '£' + year.azureCost.toLocaleString(undefined, {maximumFractionDigits: 0});
                row.insertCell(4).textContent = '£' + year.modernisationSavings.toLocaleString(undefined, {maximumFractionDigits: 0});
                row.insertCell(5).textContent = '£' + year.savings.toLocaleString(undefined, {maximumFractionDigits: 0});
                row.insertCell(6).textContent = '£' + year.cumulative.toLocaleString(undefined, {maximumFractionDigits: 0});
            });

            // Populate cost breakdown table
            const costBreakdown = document.getElementById('cost-breakdown');
            costBreakdown.innerHTML = '';
            
            let categories;
            if (inputs.cost_method === 'fixed') {
                categories = [
                    { name: 'Total On-Premises Cost', onPrem: baseAnnualOnPremCosts, azure: annualAzureCosts },
                    { name: 'Azure VMware Solution', onPrem: 0, azure: monthlyAvsNodeCost * 12 },
                    { name: 'Azure Additional Services', onPrem: 0, azure: (inputs.expressroute + inputs.azure_backup + inputs.data_transfer + inputs.monitoring + inputs.additional_storage + inputs.security_services) * 12 }
                ];
            } else {
                categories = [
                    { name: 'Infrastructure Hardware', onPrem: inputs.hardware_cost + inputs.storage_hardware + inputs.network_equipment, azure: 0 },
                    { name: 'Software Licensing', onPrem: inputs.vmware_licensing, azure: monthlyAvsNodeCost * 12 },
                    { name: 'Support & Maintenance', onPrem: inputs.support_contracts, azure: 0 },
                    { name: 'Facilities & Power', onPrem: inputs.datacenter_space + inputs.power_cooling, azure: 0 },
                    { name: 'Staff Costs', onPrem: inputs.staff_costs, azure: inputs.staff_costs * 0.7 }, // Assume 30% reduction
                    { name: 'Backup & DR', onPrem: inputs.backup_hardware, azure: inputs.azure_backup * 12 },
                    { name: 'Network & Connectivity', onPrem: inputs.connectivity, azure: inputs.expressroute * 12 + inputs.data_transfer * 12 },
                    { name: 'Additional Services', onPrem: 0, azure: (inputs.monitoring + inputs.additional_storage + inputs.security_services) * 12 }
                ];
            }

            categories.forEach(category => {
                const row = costBreakdown.insertRow();
                row.insertCell(0).textContent = category.name;
                row.insertCell(1).textContent = '£' + category.onPrem.toLocaleString(undefined, {maximumFractionDigits: 0});
                row.insertCell(2).textContent = '£' + category.azure.toLocaleString(undefined, {maximumFractionDigits: 0});
                const difference = category.onPrem - category.azure;
                const cell = row.insertCell(3);
                cell.textContent = '£' + difference.toLocaleString(undefined, {maximumFractionDigits: 0});
                cell.className = difference > 0 ? 'positive' : 'negative';
            });

            // Show results
            document.getElementById('roi-results').style.display = 'block';
            
            // Switch to results tab
            showTab('results');
            document.querySelector('.tab:nth-child(6)').classList.add('active');
        }
    </script>
</body>
</html>